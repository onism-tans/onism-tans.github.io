# 🚀 GitHub Pages 部署指南

本文档详细介绍如何将 Hexo 博客部署到 GitHub Pages，包括自动部署和手动部署两种方式。

## 📋 前置条件

- ✅ 已安装 Git
- ✅ 拥有 GitHub 账户
- ✅ Hexo 博客项目已搭建完成

## 🎯 部署方案对比

| 方案 | 优点 | 缺点 | 推荐度 |
|------|------|------|--------|
| GitHub Actions 自动部署 | 自动化、方便、支持多分支 | 需要配置 | ⭐⭐⭐⭐⭐ |
| hexo-deployer-git 手动部署 | 简单直接 | 需要手动执行 | ⭐⭐⭐ |
| GitHub Desktop | 图形化操作 | 步骤较多 | ⭐⭐ |

## 🚀 方案一：GitHub Actions 自动部署（推荐）

### 1. 创建 GitHub 仓库

#### 选项 A：用户/组织网站（推荐）
```bash
# 仓库名必须是：username.github.io
# 例如：johndoe.github.io
# 访问地址：https://username.github.io
```

#### 选项 B：项目网站
```bash
# 仓库名可以是任意名称：blog、my-blog 等
# 访问地址：https://username.github.io/repository-name
```

### 2. 初始化本地 Git 仓库

```bash
# 在博客根目录执行
cd /path/to/your/blog

# 初始化 Git 仓库
git init

# 添加远程仓库
git remote add origin https://github.com/username/username.github.io.git

# 创建 .gitignore 文件
echo "node_modules/" > .gitignore
echo "public/" >> .gitignore
echo ".deploy_git/" >> .gitignore
echo "db.json" >> .gitignore

# 添加文件到暂存区
git add .

# 提交到本地仓库
git commit -m "Initial commit: Hexo blog with Butterfly theme"

# 推送到远程仓库
git push -u origin main
```

### 3. 配置 GitHub Actions

项目已包含 `.github/workflows/deploy.yml` 文件，内容如下：

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main  # 当推送到 main 分支时触发

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        submodules: false
        
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: |
        npm install
        npm install hexo-deployer-git --save
        
    - name: Clean & Generate
      run: |
        npx hexo clean
        npx hexo generate
        
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./public
        publish_branch: gh-pages
        commit_message: ${{ github.event.head_commit.message }}
```

### 4. 设置 GitHub Pages

1. **进入仓库设置**
   - 访问 `https://github.com/username/username.github.io/settings`
   - 找到 "Pages" 选项

2. **配置 Pages 设置**
   ```
   Source: Deploy from a branch
   Branch: gh-pages
   Folder: / (root)
   ```

3. **保存设置**
   - 点击 "Save" 保存设置
   - GitHub 会显示网站访问地址

### 5. 验证部署

1. **推送代码触发部署**
   ```bash
   # 修改文件后
   git add .
   git commit -m "Update blog content"
   git push origin main
   ```

2. **查看 Actions 状态**
   - 访问仓库的 "Actions" 标签页
   - 查看工作流运行状态
   - 确认部署成功

3. **访问网站**
   - 用户网站：`https://username.github.io`
   - 项目网站：`https://username.github.io/repository-name`

## 🔧 方案二：手动部署

### 1. 安装部署插件

```bash
npm install hexo-deployer-git --save
```

### 2. 配置部署设置

编辑 `_config.yml`：

```yaml
# Deployment
deploy:
  type: git
  repo: https://github.com/username/username.github.io.git
  branch: main  # 或 gh-pages
  message: "Site updated: {{ now('YYYY-MM-DD HH:mm:ss') }}"
```

### 3. 执行部署

```bash
# 清理缓存
hexo clean

# 生成静态文件
hexo generate

# 部署到 GitHub
hexo deploy

# 或一键生成并部署
hexo generate --deploy
# 简写：hexo g -d
```

### 4. 设置 GitHub Pages

如果使用 `main` 分支部署：
```
Source: Deploy from a branch
Branch: main
Folder: / (root)
```

如果使用 `gh-pages` 分支部署：
```
Source: Deploy from a branch
Branch: gh-pages
Folder: / (root)
```

## 🌐 自定义域名配置

### 1. 购买域名

推荐域名注册商：
- [Namecheap](https://www.namecheap.com/)
- [GoDaddy](https://www.godaddy.com/)
- [阿里云](https://wanwang.aliyun.com/)
- [腾讯云](https://dnspod.cloud.tencent.com/)

### 2. 配置 DNS 解析

#### 方式一：CNAME 记录（推荐）
```
类型: CNAME
名称: www (或 @)
值: username.github.io
TTL: 3600
```

#### 方式二：A 记录
```
类型: A
名称: @
值: 185.199.108.153
TTL: 3600

类型: A
名称: @
值: 185.199.109.153
TTL: 3600

类型: A
名称: @
值: 185.199.110.153
TTL: 3600

类型: A
名称: @
值: 185.199.111.153
TTL: 3600
```

### 3. 配置 GitHub Pages

1. **添加 CNAME 文件**
   ```bash
   # 在 source 目录下创建 CNAME 文件
   echo "yourdomain.com" > source/CNAME
   ```

2. **GitHub 设置**
   - 仓库设置 → Pages
   - Custom domain: `yourdomain.com`
   - 勾选 "Enforce HTTPS"

### 4. 验证配置

```bash
# 检查 DNS 解析
nslookup yourdomain.com

# 检查 HTTPS 证书
curl -I https://yourdomain.com
```

## 🔒 HTTPS 配置

### GitHub Pages 自动 HTTPS

GitHub Pages 会自动为自定义域名提供免费的 SSL 证书：

1. **等待证书生成**
   - 配置域名后等待 24 小时
   - GitHub 会自动申请 Let's Encrypt 证书

2. **启用 HTTPS**
   - 仓库设置 → Pages
   - 勾选 "Enforce HTTPS"

### 故障排除

如果 HTTPS 无法启用：

1. **检查 DNS 配置**
   ```bash
   dig yourdomain.com
   ```

2. **清除 DNS 缓存**
   ```bash
   # Windows
   ipconfig /flushdns
   
   # macOS
   sudo dscacheutil -flushcache
   
   # Linux
   sudo systemctl restart systemd-resolved
   ```

3. **等待传播**
   - DNS 更改可能需要 24-48 小时生效

## 🚀 性能优化

### 1. 启用 CDN

#### Cloudflare（免费）

1. **注册 Cloudflare 账户**
2. **添加网站**
   - 输入域名
   - 选择免费计划
3. **更改 DNS 服务器**
   - 在域名注册商处修改 DNS 服务器
   - 使用 Cloudflare 提供的 DNS 服务器
4. **配置设置**
   - SSL/TLS: Full
   - Speed: 启用自动压缩
   - Caching: 设置缓存规则

#### jsDelivr（免费）

```html
<!-- 在主题配置中使用 jsDelivr 加速静态资源 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly/source/css/index.css">
```

### 2. 图片优化

```bash
# 安装图片压缩插件
npm install hexo-imagemin --save

# 配置 _config.yml
imagemin:
  enable: true
  interlaced: false
  multipass: false
  optimizationLevel: 2
  pngquant: false
  progressive: false
```

### 3. 代码压缩

```bash
# 安装压缩插件
npm install hexo-neat --save

# 配置 _config.yml
neat_enable: true
neat_html:
  enable: true
  exclude:
neat_css:
  enable: true
  exclude:
    - '*.min.css'
neat_js:
  enable: true
  mangle: true
  output:
  compress:
  exclude:
    - '*.min.js'
```

## 📊 SEO 优化

### 1. 站点地图提交

```bash
# Google Search Console
https://search.google.com/search-console

# 提交站点地图
https://yourdomain.com/sitemap.xml
```

### 2. robots.txt

创建 `source/robots.txt`：

```
User-agent: *
Allow: /

Sitemap: https://yourdomain.com/sitemap.xml
```

### 3. 百度收录

```html
<!-- 在主题配置中添加百度统计 -->
baidu_analytics: your_baidu_analytics_id

<!-- 百度站长验证 -->
<meta name="baidu-site-verification" content="your_verification_code">
```

## 🔍 故障排除

### 常见问题

#### 1. 部署失败

**错误信息**：`fatal: could not read Username for 'https://github.com'`

**解决方案**：
```bash
# 配置 Git 凭据
git config --global user.name "Your Name"
git config --global user.email "your@email.com"

# 使用 SSH 方式
git remote set-url origin git@github.com:username/username.github.io.git
```

#### 2. 页面 404

**可能原因**：
- GitHub Pages 未正确配置
- 分支设置错误
- CNAME 文件配置问题

**解决方案**：
```bash
# 检查分支
git branch -a

# 检查 GitHub Pages 设置
# 确认 Source 分支设置正确
```

#### 3. 样式丢失

**可能原因**：
- 相对路径配置错误
- CDN 资源加载失败

**解决方案**：
```yaml
# _config.yml
url: https://yourdomain.com
root: /

# 如果是项目网站
url: https://username.github.io/repository-name
root: /repository-name/
```

#### 4. 自动部署失败

**检查步骤**：
1. 查看 Actions 日志
2. 检查 workflow 文件语法
3. 确认权限设置

```yaml
# 在 workflow 中添加调试信息
- name: Debug
  run: |
    ls -la
    pwd
    node --version
    npm --version
```

### 日志查看

```bash
# 查看 Hexo 详细日志
hexo --debug

# 查看 Git 操作日志
git log --oneline

# 查看远程仓库状态
git remote -v
```

## 📚 扩展功能

### 1. 多环境部署

```yaml
# _config.yml
deploy:
  - type: git
    repo: https://github.com/username/username.github.io.git
    branch: main
  - type: git
    repo: https://gitee.com/username/username.git
    branch: master
```

### 2. 预览分支

```yaml
# .github/workflows/preview.yml
name: Deploy Preview

on:
  pull_request:
    branches: [ main ]

jobs:
  preview:
    runs-on: ubuntu-latest
    steps:
    # ... 构建步骤
    - name: Deploy to Preview
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./public
        publish_branch: preview
        destination_dir: pr-${{ github.event.number }}
```

### 3. 自动更新依赖

```yaml
# .github/workflows/update-deps.yml
name: Update Dependencies

on:
  schedule:
    - cron: '0 0 * * 0'  # 每周日执行

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Update dependencies
      run: |
        npm update
        git add package*.json
        git commit -m "chore: update dependencies" || exit 0
        git push
```

## 📞 获取帮助

### 官方文档
- [Hexo 官方文档](https://hexo.io/docs/)
- [GitHub Pages 文档](https://docs.github.com/en/pages)
- [GitHub Actions 文档](https://docs.github.com/en/actions)

### 社区支持
- [Hexo GitHub Issues](https://github.com/hexojs/hexo/issues)
- [Butterfly 主题文档](https://butterfly.js.org/)
- [Stack Overflow](https://stackoverflow.com/questions/tagged/hexo)

### 联系方式
如果遇到问题，可以通过以下方式获取帮助：
- 📧 Email: your@email.com
- 🐙 GitHub Issues: [创建 Issue](https://github.com/username/blog/issues)

---

🎉 **恭喜！** 你的博客现在已经成功部署到 GitHub Pages！
