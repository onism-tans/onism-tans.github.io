# 📸 图床配置指南

本文档详细介绍如何配置图床服务，实现 Markdown 图片的自动上传和管理。

## 🎯 推荐方案

### 方案对比

| 方案 | 优点 | 缺点 | 推荐度 |
|------|------|------|--------|
| GitHub 图床 | 免费、稳定、支持 CDN 加速 | 国内访问较慢 | ⭐⭐⭐⭐ |
| Cloudflare R2 | 速度快、免费额度大 | 配置稍复杂 | ⭐⭐⭐⭐⭐ |
| 七牛云 | 国内访问快 | 免费额度有限 | ⭐⭐⭐ |
| 阿里云 OSS | 稳定可靠 | 收费 | ⭐⭐⭐ |

## 🚀 方案一：GitHub 图床 + PicGo

### 1. 创建 GitHub 图床仓库

1. **新建仓库**
   - 仓库名：`blog-images`（或其他名称）
   - 设置为 **Public**（公开仓库）
   - 勾选 "Add a README file"

2. **生成 Personal Access Token**
   - 访问：Settings → Developer settings → Personal access tokens → Tokens (classic)
   - 点击 "Generate new token (classic)"
   - 设置过期时间：No expiration（永不过期）
   - 权限选择：勾选 `repo`
   - 复制生成的 Token（只显示一次）

### 2. 安装 PicGo

#### 方式一：下载客户端（推荐）
```bash
# 访问官网下载
https://github.com/Molunerfinn/PicGo/releases

# 选择对应系统版本：
# Windows: PicGo-Setup-2.x.x.exe
# macOS: PicGo-2.x.x.dmg
# Linux: PicGo-2.x.x.AppImage
```

#### 方式二：命令行版本
```bash
npm install picgo -g
```

### 3. 配置 PicGo

#### 客户端配置

1. **打开 PicGo → 图床设置 → GitHub**

2. **填写配置信息**：
   ```
   仓库名: yourusername/blog-images
   分支名: main
   Token: 刚才生成的 Personal Access Token
   存储路径: images/  （可选，图片存储的子目录）
   自定义域名: https://cdn.jsdelivr.net/gh/yourusername/blog-images@main/
   ```

3. **设置为默认图床**

#### 命令行配置
```bash
# 配置 GitHub 图床
picgo set uploader github

# 按提示填入信息
# repo: yourusername/blog-images
# branch: main
# token: your_personal_access_token
# path: images/
# customUrl: https://cdn.jsdelivr.net/gh/yourusername/blog-images@main/
```

### 4. 使用方法

#### 客户端使用
1. **拖拽上传**：直接将图片拖到 PicGo 窗口
2. **剪贴板上传**：截图后点击"剪贴板图片"上传
3. **快捷键上传**：设置全局快捷键（如 Ctrl+Shift+U）

#### 命令行使用
```bash
# 上传单张图片
picgo upload /path/to/image.jpg

# 上传多张图片
picgo upload /path/to/image1.jpg /path/to/image2.png

# 从剪贴板上传
picgo upload
```

### 5. CDN 加速配置

使用 jsDelivr 加速访问：
```
自定义域名: https://cdn.jsdelivr.net/gh/用户名/仓库名@分支名/
```

示例：
```
https://cdn.jsdelivr.net/gh/username/blog-images@main/images/photo.jpg
```

## ☁️ 方案二：Cloudflare R2

### 1. 创建 Cloudflare 账户

1. 访问 [Cloudflare](https://cloudflare.com)
2. 注册并登录账户
3. 进入 R2 Object Storage

### 2. 创建 R2 存储桶

1. **创建存储桶**
   - 名称：`blog-images`
   - 区域：选择就近区域

2. **配置公共访问**
   - 设置 → 公共访问
   - 允许访问：启用
   - 自定义域名：可选配置

### 3. 获取 API 凭证

1. **创建 API Token**
   - My Profile → API Tokens
   - Create Token
   - 权限：Cloudflare R2:Edit

2. **获取账户信息**
   - Account ID：在右侧边栏查看
   - Access Key ID 和 Secret Access Key

### 4. 配置 PicGo

#### 安装 S3 插件
```bash
# 客户端：插件设置 → 搜索 "s3" → 安装

# 命令行
picgo install s3
```

#### 配置参数
```json
{
  "accessKeyId": "your_access_key_id",
  "secretAccessKey": "your_secret_access_key",
  "bucketName": "blog-images",
  "uploadPath": "images/{year}/{month}/",
  "region": "auto",
  "endpoint": "https://your-account-id.r2.cloudflarestorage.com",
  "customUrl": "https://your-custom-domain.com"
}
```

### 5. 自定义域名（可选）

1. **添加自定义域名**
   - R2 存储桶 → 设置 → 自定义域名
   - 添加域名：`img.yourdomain.com`

2. **配置 DNS**
   - 在域名 DNS 设置中添加 CNAME 记录
   - 指向 Cloudflare 提供的地址

## 🛠️ 方案三：七牛云图床

### 1. 注册七牛云账户

1. 访问 [七牛云](https://www.qiniu.com/)
2. 注册并实名认证
3. 创建对象存储空间

### 2. 创建存储空间

1. **新建存储空间**
   - 存储空间名称：`blog-images`
   - 存储区域：选择就近区域
   - 访问控制：公开空间

2. **获取域名**
   - 测试域名：七牛提供的临时域名
   - 自定义域名：需要备案的域名

### 3. 获取密钥

1. **访问密钥管理**
   - 个人中心 → 密钥管理
   - 获取 AccessKey 和 SecretKey

### 4. 配置 PicGo

```json
{
  "accessKey": "your_access_key",
  "secretKey": "your_secret_key",
  "bucket": "blog-images",
  "url": "http://your-domain.com",
  "area": "z0",
  "options": "",
  "path": "images/"
}
```

## 📱 移动端解决方案

### iOS 快捷指令

1. **下载快捷指令 App**
2. **创建上传快捷指令**
   - 获取剪贴板图片
   - 调用 PicGo API
   - 复制 Markdown 链接

### Android 解决方案

1. **使用 Termux**
   ```bash
   pkg install nodejs-lts
   npm install picgo -g
   ```

2. **配置自动化工具**
   - Tasker + PicGo
   - 实现截图自动上传

## 🔧 高级配置

### 批量重命名

```javascript
// PicGo 重命名插件配置
{
  "template": "{year}-{month}-{day}-{hour}{minute}{second}-{hash}{ext}",
  "dateFormat": "YYYY-MM-DD"
}
```

### 图片压缩

```javascript
// 压缩配置
{
  "quality": 80,
  "maxWidth": 1920,
  "maxHeight": 1080
}
```

### 水印添加

```javascript
// 水印配置
{
  "text": "© 我的博客",
  "position": "bottom-right",
  "opacity": 0.5
}
```

## 📋 使用技巧

### 1. Markdown 图片语法

```markdown
# 基本语法
![alt text](image_url)

# 带标题
![alt text](image_url "title")

# 指定大小（部分编辑器支持）
![alt text](image_url){width=500}

# HTML 语法（更灵活）
<img src="image_url" alt="alt text" width="500" />
```

### 2. 批量上传脚本

```bash
#!/bin/bash
# 批量上传当前目录下的所有图片
for file in *.{jpg,jpeg,png,gif,webp}; do
    if [ -f "$file" ]; then
        picgo upload "$file"
    fi
done
```

### 3. 自动化工作流

#### VS Code 插件
安装 "PicGo" 插件：
- 快捷键：Ctrl+Alt+U
- 自动上传剪贴板图片
- 插入 Markdown 链接

#### Typora 集成
```json
// Typora 偏好设置 → 图像 → 上传服务设定
{
  "picBed": "PicGo(app)",
  "picgoPath": "C:/Program Files/PicGo/PicGo.exe"
}
```

## 🚨 注意事项

### 1. 安全建议

- **保护 API 密钥**：不要将密钥提交到公开仓库
- **定期更换**：建议定期更换 Access Token
- **权限最小化**：只给必要的权限

### 2. 使用限制

#### GitHub 图床
- 单文件大小：< 100MB
- 仓库总大小：< 1GB（推荐）
- API 调用限制：5000次/小时

#### Cloudflare R2
- 免费额度：10GB 存储 + 1000万次读取/月
- 单文件大小：< 5TB
- 上传速度：较快

#### 七牛云
- 免费额度：10GB 存储 + 10GB 流量/月
- 单文件大小：< 1GB
- 需要实名认证

### 3. 备份策略

```bash
# 定期备份图片
git clone https://github.com/yourusername/blog-images.git
cd blog-images
git pull origin main

# 或使用 rsync 同步
rsync -av --delete remote:blog-images/ local-backup/
```

## 🔍 故障排除

### 常见问题

1. **上传失败**
   - 检查网络连接
   - 验证 API 密钥
   - 确认存储空间配置

2. **图片无法显示**
   - 检查图片 URL 是否正确
   - 验证存储空间访问权限
   - 确认 CDN 配置

3. **上传速度慢**
   - 选择就近的存储区域
   - 使用 CDN 加速
   - 压缩图片大小

### 调试方法

```bash
# PicGo 日志查看
picgo log

# 测试配置
picgo test

# 重置配置
picgo reset
```

## 📚 扩展阅读

- [PicGo 官方文档](https://picgo.github.io/PicGo-Doc/)
- [Cloudflare R2 文档](https://developers.cloudflare.com/r2/)
- [GitHub API 文档](https://docs.github.com/en/rest)
- [七牛云对象存储文档](https://developer.qiniu.com/kodo)

---

💡 **小贴士**：建议先使用 GitHub 图床熟悉流程，后续可根据需要迁移到其他方案。
